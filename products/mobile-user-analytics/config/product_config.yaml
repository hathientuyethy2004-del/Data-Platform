# Mobile User Analytics Product Configuration

product:
  id: mobile-user-analytics
  name: "Mobile User Analytics"
  version: "1.0.0"
  owner: "@team-mobile"
  team: "Mobile Analytics Team"
  slack_channel: "#mobile-analytics"
  
# SLA Configuration
sla:
  uptime_target: 99.9
  response_time_p99_ms: 1000
  availability_window: "24/7"
  support_tier: "24/7-oncall"

# Ingestion Configuration
ingestion:
  topics:
    - topic_app_events
    - topic_mobile_sessions
  consumer_group: "mobile-analytics-consumer"
  batch_size: 1000
  timeout_ms: 30000
  max_retries: 3
  
  # Kafka credentials
  kafka:
    brokers:
      - "kafka-1:9092"
      - "kafka-2:9092"
      - "kafka-3:9092"
    security_protocol: "SASL_SSL"
    sasl_mechanism: "PLAIN"

# Processing Configuration
processing:
  spark_app_name: "mobile-user-analytics-processor"
  execution_mode: "cluster"  # cluster or local
  
  jobs:
    - id: "event_aggregation"
      schedule: "*/10 * * * *"  # Every 10 minutes
      type: "streaming"
      
    - id: "session_analysis"
      schedule: "0 * * * *"  # Hourly
      type: "batch"
      
    - id: "daily_metrics"
      schedule: "0 2 * * *"  # 2 AM daily
      type: "batch"

# Storage Configuration (Delta Lake)
storage:
  mode: "delta"  # delta, parquet, or iceberg
  
  bronze:
    path: "/data_lake/bronze/app_events_bronze"
    format: "delta"
    partition_by: ["event_date"]
    retention_days: 90
    
  silver:
    path: "/data_lake/silver/app_events_silver"
    format: "delta"
    partition_by: ["event_date", "event_hour"]
    retention_days: 365
    z_order_by: ["user_id", "event_type"]
    
  gold:
    path: "/data_lake/gold/mobile_analytics"
    format: "delta"
    partition_by: ["date"]
    retention_days: 2555  # ~7 years

# Serving Configuration
serving:
  api:
    host: "0.0.0.0"
    port: 8001
    workers: 4
    timeout_seconds: 30
    enable_cors: true
    
  cache:
    enabled: true
    backend: "redis"
    ttl_seconds: 3600
    
  rate_limiting:
    enabled: true
    requests_per_minute: 1000

# Monitoring Configuration
monitoring:
  metrics:
    enabled: true
    prometheus_port: 9090
    
  health_checks:
    enabled: true
    interval_seconds: 60
    
  logging:
    level: "INFO"
    format: "json"
    
  alerts:
    enabled: true
    slack_webhook: "${SLACK_WEBHOOK_URL}"
    critical_channels: ["#mobile-analytics-incidents"]

# Data Quality Configuration
data_quality:
  enabled: true
  checks:
    - null_check
    - duplicate_check
    - schema_validation
    - range_check
    - completeness_check
  
  rules:
    - table: "app_events_silver"
      field: "user_id"
      type: "not_null"
      
    - table: "app_events_silver"
      field: "event_type"
      type: "in_list"
      values: ["launch", "click", "view", "purchase"]

# Access Control
access_control:
  enabled: true
  default_role: "viewer"
  
  roles:
    viewer:
      - read:gold
      - read:metrics
      
    analyst:
      - read:gold
      - read:silver
      - write:queries
      
    admin:
      - read:*
      - write:*
      - delete:*

# Environments
environments:
  development:
    kafka_brokers: ["kafka-dev:9092"]
    
  staging:
    kafka_brokers: ["kafka-staging:9092"]
    
  production:
    kafka_brokers: ["kafka-prod-1:9092", "kafka-prod-2:9092", "kafka-prod-3:9092"]
    enable_backups: true
    backup_interval_hours: 6
